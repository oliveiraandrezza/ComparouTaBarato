<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Comparou t√° Barato</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="app-header">
    <h1>Comparou t√° Barato</h1>
    <div class="topbar">
      <div class="region-tag">
        <label for="regiaoSel" class="sr-only">Regi√£o</label>
        <span aria-hidden="true">üìç Regi√£o</span>
        <select id="regiaoSel" aria-label="Selecionar regi√£o">
          <option>Todas</option>
          <option>Campinas</option>
          <option>Americana</option>
          <option selected>Monte Mor</option>
          <option>Itapira</option>
        </select>
      </div>
      <div class="auth">
        <span id="authStatus" class="badge" style="display:none;">Logado</span>
        <button id="btnLogin" class="btn-link" type="button" aria-haspopup="dialog" aria-controls="loginModal">Entrar</button>
        <button id="btnLogout" class="btn-link" type="button" style="display:none;">Sair</button>
      </div>
    </div>
  </header>

  <!-- FILTROS -->
  <section class="controls" aria-label="Filtros e ordena√ß√£o">
    <div>
      <label for="busca" class="sr-only">Buscar produto ou mercado</label>
      <input id="busca" type="text" placeholder="Buscar produto ou mercado..." />
    </div>
    <div>
      <label for="categoria" class="sr-only">Categoria</label>
      <select id="categoria">
        <option value="">Todas as categorias</option>
        <option value="cesta_basica">Cesta b√°sica</option>
        <option value="hortifruti">Hortifruti</option>
        <option value="limpeza">Limpeza</option>
        <option value="outras">Outras</option>
      </select>
    </div>
    <div>
      <label for="ordenacao" class="sr-only">Ordena√ß√£o</label>
      <select id="ordenacao">
        <option value="preco_asc">Pre√ßo: menor ‚Üí maior</option>
        <option value="preco_desc">Pre√ßo: maior ‚Üí menor</option>
        <option value="loja_az">Loja: A ‚Üí Z</option>
        <option value="loja_za">Loja: Z ‚Üí A</option>
      </select>
    </div>
  </section>

  <!-- BOT√ÉO INDICADORES -->
  <div class="container">
    <button id="btnToggleIndicadores" class="btn-primary" type="button" aria-expanded="false" aria-controls="indicadoresWrap">üìä Mostrar Indicadores</button>
  </div>

  <!-- BLOQUEIO DE CADASTRO SE REGI√ÉO = TODAS -->
  <div id="formBlocked" class="alert" style="display:none;" role="status" aria-live="polite">
    Selecione uma <b>regi√£o espec√≠fica</b> para cadastrar promo√ß√µes.  
    A op√ß√£o <b>Todas</b> √© apenas para visualizar indicadores e produtos.
  </div>

  <!-- FORMUL√ÅRIO DE CADASTRO -->
  <form id="form" class="form" style="display:none;" aria-labelledby="formTitle">
    <h2 id="formTitle" class="sr-only">Cadastrar promo√ß√£o</h2>
    <div class="grid">
      <div>
        <label for="f_product">Produto</label>
        <input id="f_product"  placeholder="Produto *" />
      </div>
      <div>
        <label for="f_brand">Marca</label>
        <input id="f_brand"    placeholder="Marca" />
      </div>
      <div>
        <label for="f_store">Loja</label>
        <input id="f_store" list="d_lojas" placeholder="Loja * (selecione ou digite)" />
        <datalist id="d_lojas"></datalist>
      </div>
      <div>
        <label for="f_price">Pre√ßo</label>
        <input id="f_price"    placeholder="Pre√ßo * (ex.: 5.99)" inputmode="decimal" />
      </div>
      <div>
        <label for="f_unit">Unidade</label>
        <input id="f_unit"     placeholder="Unidade * (ex.: un, kg)" />
      </div>
      <div>
        <label for="f_category">Categoria</label>
        <select id="f_category">
          <option value="">Categoria *</option>
          <option value="cesta_basica">Cesta b√°sica</option>
          <option value="hortifruti">Hortifruti</option>
          <option value="limpeza">Limpeza</option>
          <option value="outras">Outras</option>
        </select>
      </div>
      <div>
        <label for="f_region">Regi√£o selecionada</label>
        <input id="f_region" value="Monte Mor" disabled />
      </div>
    </div>
    <button type="submit">Cadastrar promo√ß√£o</button>
  </form>

  <!-- ===================== INDICADORES ===================== -->
  <div id="indicadoresWrap" class="collapsible" style="display:none;">
    <h2 class="section-title">Indicadores Quantitativos Gerais e Pre√ßo</h2>
    <div id="stats" class="stats"></div>

    <h2 class="section-title">Indicadores de Pre√ßo</h2>
    <div class="cards">
      <article class="cardbox">
        <header class="card-title">Comparativo Pre√ßo M√©dio Por Regi√£o</header>
        <div id="cmpRegioes"></div>
      </article>

      <article class="cardbox">
        <header class="card-title">Comparativo Pre√ßo M√©dio Por Loja Na Regi√£o</header>
        <div id="cmpLojas"></div>
      </article>

      <article class="cardbox">
        <header class="card-title">Comparativo Pre√ßo M√©dio Por Categoria Na Regi√£o</header>
        <div id="cmpCategorias"></div>
      </article>

      <!-- TOP 3 em LINHAS -->
      <article class="cardbox cardbox--wide">
        <header class="card-title">Top 3 Produtos Mais Baratos Por Categoria</header>
        <p class="muted small">Regi√£o atual</p>
        <div id="top3" class="t3list"></div>
      </article>
    </div>

    <h2 class="section-title">Gr√°ficos</h2>
    <div class="cards">
      <article class="cardbox">
        <header class="card-title">Pre√ßo M√©dio por Regi√£o</header>
        <div class="chart-wrap"><canvas id="chartRegioes" aria-label="Gr√°fico de pre√ßo m√©dio por regi√£o" role="img"></canvas></div>
      </article>

      <article class="cardbox">
        <header class="card-title">Pre√ßo M√©dio por Loja na regi√£o</header>
        <div class="chart-wrap"><canvas id="chartLojas" aria-label="Gr√°fico de pre√ßo m√©dio por loja" role="img"></canvas></div>
      </article>

      <article class="cardbox">
        <header class="card-title">Pre√ßo M√©dio por Categoria na regi√£o</header>
        <div class="chart-wrap"><canvas id="chartCategorias" aria-label="Gr√°fico de pre√ßo m√©dio por categoria" role="img"></canvas></div>
      </article>
    </div>
  </div>
  <!-- =================== /INDICADORES ====================== -->

  <div id="lista" class="list"></div>
  <div id="vazio" class="empty" style="display:none;">Nenhum item encontrado na regi√£o selecionada.</div>

  <!-- Pagina√ß√£o -->
  <nav class="pagination" aria-label="Pagina√ß√£o de resultados">
    <button id="prevPage" type="button">‚Üê Anterior</button>
    <span id="pageInfo">P√°gina 1</span>
    <button id="nextPage" type="button">Pr√≥xima ‚Üí</button>
  </nav>

  <!-- Modal de login -->
  <div id="loginModal" class="modal-bg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <h3 id="loginTitle">Entrar</h3>
      <div class="field">
        <label for="loginUser">Usu√°rio</label>
        <input id="loginUser" placeholder="admin" autocomplete="username" autocapitalize="none" />
      </div>
      <div class="field">
        <label for="loginPass">Senha</label>
        <input id="loginPass" type="password" placeholder="1234" autocomplete="current-password" />
      </div>
      <div class="rowbtn">
        <button class="confirm" id="doLogin" type="button">Entrar</button>
        <button class="cancel" id="cancelLogin" type="button">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js"></script>
</body>
</html>
